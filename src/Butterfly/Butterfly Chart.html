<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Butterfly Chart</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --card-w:1400px;          /* allow the chart to span wider on large screens */
    --bg-grad:#000000;      /* default to dark; JS flips for light mode */
    --text:#f1f5f9;
    --muted:#cbd5e1;
    --panel:transparent;    /* chart sits directly on the page */
    --panel-border:transparent; /* no visible frame in dark mode */
    --grid:#000000;
    --axis:#000000;
    --shadow-1:none;
    --shadow-2:none;
  }
  :root[data-dark="true"]{
    --bg-grad:#000000;
    --text:#f1f5f9;
    --muted:#cbd5e1;
    --panel:transparent;
    --panel-border:transparent;
    --grid:#000000;
    --axis:#000000;
    --shadow-1:none;
    --shadow-2:none;
  }
  *{box-sizing:border-box}
  body{
    font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    margin:0; padding:28px 16px 52px; color:var(--text);
    background: var(--bg-grad);
  }
  @media (prefers-reduced-motion: reduce){
    body{ animation: none !important; }
  }
  @keyframes bgMove{
    0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%}
  }

  header{ max-width:var(--card-w); margin:0 auto 12px; display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
  h1{ margin:0 0 2px; font-weight:800; letter-spacing:.2px; font-size:32px; flex:1 1 100%; }
  .toolbar{
    display:flex; gap:8px; flex-wrap:wrap; width:100%;
    margin-left:0;
  }
  .control{
    display:flex; gap:6px; align-items:center; background:transparent; border:none;
    padding:4px 0 4px 0;
    border-radius:0; box-shadow:none;
  }
  select, button, label.switch{
    font: 500 13px/1 'Poppins',sans-serif; color:var(--text);
  }
  select, button{
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:10px;        
    height:30px;               
    padding:0 14px;            
    display:inline-flex;
    align-items:center;
    cursor:pointer;
    transition:.2s;
    box-shadow:0 1px 3px rgba(0,0,0,.08); 
  }
  
  select{
    padding-right:32px;
  }
  :root[data-dark="true"] select, :root[data-dark="true"] button{
    background:#000000; border-color:#4b5563; color:var(--text);
  }
  select:hover, button:hover{ transform:translateY(-1px); background:#f9fafb; box-shadow:0 4px 12px rgba(0,0,0,.08) }
  :root[data-dark="true"] select:hover, :root[data-dark="true"] button:hover{ background:#121632 }

  .switch{ user-select:none; cursor:pointer; }
  .switch input{ display:none }
  .switch .pill{
    width:44px; height:24px; border-radius:999px; background:#e5e7eb; position:relative; transition:.2s;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
  }
  :root[data-dark="true"] .switch .pill{ background:#24314a; }
  .switch .dot{
    position:absolute; top:3px; left:3px; width:18px; height:18px; border-radius:50%; background:#fff; transition: transform .2s;
    box-shadow: 0 1px 3px rgba(0,0,0,.25);
  }
  .switch input:checked + .pill .dot{ transform: translateX(20px); }

  .panel{
    width:100%; max-width:var(--card-w); margin:10px auto 0; padding:0;
    border:none; border-radius:0; background:var(--panel);
    box-shadow:none; position:relative; overflow:visible;
  }
  #chart svg{ width:100%; height:auto; display:block; overflow:visible; }

  .axis-top text{ fill:var(--muted); font-size:12px; font-weight:600; font-family:'Poppins',sans-serif; }
  .axis-top .domain,.axis-top line{ stroke:var(--axis); }
  .age-label{ font-family:'Poppins',sans-serif; font-weight:700; fill:var(--text); }
  .axis-left text{ font-size:14px; }

  .leftG,.rightG{ will-change:transform; cursor:pointer; }
  .leftG:focus, .rightG:focus, .leftG rect:focus, .rightG rect:focus { outline: none; }
  .bar-left, .bar-right { pointer-events:auto; }
  .bead, .bar-left-ghost, .bar-right-ghost { pointer-events:none; }
  .grid line{ stroke:var(--grid); stroke-opacity:.35; stroke-width:0.6; }
  .grid .domain{ display:none; }

  /* Tooltip */
  #tip{
    position:fixed; top:0; left:0; transform:translate(12px,10px);
    background:#fff; color:var(--text); padding:12px 14px; border-radius:12px; font-size:14px; line-height:1.5;
    border:1px solid var(--panel-border);
    box-shadow: 0 10px 30px rgba(0,0,0,.10);
    pointer-events:none; opacity:0; transition:opacity .08s ease-out; z-index:1000;
  }
  :root[data-dark="true"] #tip{ background:#121526; color:#f1f5f9; border-color:#233042 }

  .sr-only{
    position:absolute!important; width:1px!important; height:1px!important; padding:0!important; margin:-1px!important; overflow:hidden!important; clip:rect(0,0,0,0)!important; white-space:nowrap!important; border:0!important;
  }

  #chart{
    transition: opacity .35s ease-out;
  }
  body[data-view="detail"] #chart{
    opacity:0; pointer-events:none;
    height:0; overflow:hidden;
  }
  #detailScreen{
    max-width:1100px;
    margin:48px auto 0;
    opacity:0; pointer-events:none;
    transition: opacity .35s ease-out;
  }
  body[data-view="detail"] #detailScreen{
    opacity:1; pointer-events:auto;
  }
  #detailHeaderRow{
    display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;
  }
  #detailTitleFull{
    font-size:22px; font-weight:800;
  }
  #detailBack{
    border-radius:999px; border:1px solid var(--panel-border);
    background:var(--panel); color:var(--text);
    padding:4px 14px; font-size:12px; cursor:pointer;
  }
  #detailMetaFull{
    font-size:14px; color:var(--muted); margin-bottom:18px;
  }
  #detailBars{
    display:flex; flex-direction:column; gap:8px; margin-bottom:16px;
  }
  .detail-bar-row{
    display:flex; flex-direction:column; gap:4px;
  }
  .detail-bar-label{
    font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted);
  }
  .detail-bar-track{
    width:100%; height:16px; border-radius:999px; background:rgba(148,163,184,.3); overflow:hidden;
  }
  .detail-bar-fill{
    height:100%; border-radius:999px;
  }
  .detail-bar-fill.left{ background:linear-gradient(to right,#9999FF,#9999FF); }
  .detail-bar-fill.right{ background:linear-gradient(to right,#FF9999,#FF9999); }
  #detailStatsGrid{
    display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px 16px; font-size:13px;
  }
  .detail-stat-label{
    font-size:11px; text-transform:uppercase; letter-spacing:.08em; color:var(--muted);
  }
  .detail-stat-value{
    font-weight:700; font-size:15px;
  }

  /* Responsive */
  @media (max-width: 860px){
    h1{ font-size:26px }
    .control{ width:100%; }
  }
</style>
</head>
<body>
  <header aria-label="Butterfly chart controls">
    <h1>Butterfly Chart</h1>
    <div class="toolbar">
      <div class="control">
        <button id="sortBtn" aria-pressed="false" aria-label="Toggle sort order">Sort by Diff</button>
      </div>

    
    </div>
  </header>

  <div id="statusMsg" style="max-width:var(--card-w); margin:10px auto 0; font-size:12px; color:var(--muted); text-align:left;"></div>
  <div id="chart" class="panel" role="group" aria-label="Male versus Female by age"></div>
  <div id="tip" role="status" aria-live="polite"></div>
  <div id="detailScreen" aria-live="polite" aria-label="Detail view for selected country">
    <div id="detailHeaderRow">
      <div id="detailTitleFull"></div>
      <button id="detailBack">Back to full chart</button>
    </div>
    <div id="detailMetaFull"></div>
    <div id="detailBars">
      <div class="detail-bar-row">
        <div class="detail-bar-label" id="detailLeftLabel"></div>
        <div class="detail-bar-track"><div class="detail-bar-fill left" id="detailLeftFill" style="width:0%"></div></div>
      </div>
      <div class="detail-bar-row">
        <div class="detail-bar-label" id="detailRightLabel"></div>
        <div class="detail-bar-track"><div class="detail-bar-fill right" id="detailRightFill" style="width:0%"></div></div>
      </div>
    </div>
    <div id="detailStatsGrid">
      <div>
        <div class="detail-stat-label" id="statLabelLeft"></div>
        <div class="detail-stat-value" id="statValueLeft"></div>
      </div>
      <div>
        <div class="detail-stat-label" id="statLabelRight"></div>
        <div class="detail-stat-value" id="statValueRight"></div>
      </div>
      <div>
        <div class="detail-stat-label">Total</div>
        <div class="detail-stat-value" id="statTotal"></div>
      </div>
      <div>
        <div class="detail-stat-label">Diff</div>
        <div class="detail-stat-value" id="statDiff"></div>
      </div>
      <div>
        <div class="detail-stat-label" id="statShareLabel"></div>
        <div class="detail-stat-value" id="statShare"></div>
      </div>
      <div>
        <div class="detail-stat-label">Diff rank</div>
        <div class="detail-stat-value" id="statRank"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script> <!-- calling createButterflyChart -->
  <script type="module">
    import { createButterflyChart } from './index.js';

    createButterflyChart({
      containerSelector: '#chart',
      statusSelector: '#statusMsg',
      sortButtonSelector: '#sortBtn',
      labels: { left: 'Exports', right: 'Imports' },
      dataSource: {
        type: 'csv',
        url: 'countries.csv',
        categoryCol: 'country',
        leftCol: 'exports',
        rightCol: 'imports',
        rightScale: 1
      },
      chartTitle: 'Exports vs Imports by Country',
      initialMode: 'dark'
    });
  </script>
</body>
</html>
